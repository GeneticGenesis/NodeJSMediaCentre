var PlexAPI = require("plex-api");
var client = new PlexAPI("yoshi");

var tvShowsId = 1;

var getAllTvShows = function(req, res, next) {

    client.query("/library/sections/" + tvShowsId  + "/all").then(function (result) {

	    console.log(result.directory[result.directory.length -1]);
	    res.send(200, result.directory);
	    
	}, function (err) {
	    throw new Error("Could not connect to server");
	});
}

var getChildrenByKey = function(req, res, next) {

    client.query('/library/metadata/' + req.params.key + '/children').then(function (result) {

	    //	    console.log(result.directory[result.directory.length -1]);
	    console.log(result.directory);

	    res.send(200, result.directory);
	    
	}, function (err) {
	    console.log("In error handler...");
	    throw new Error("Could not connect to server");
	});
}

// Expose API
exports.getAllTvShows = getAllTvShows;
exports.getChildrenByKey = getChildrenByKey;

//      getTvAllShows();

//	console.log(result.directory);

//	    for (var i = 0; i < result.directory.length; i++) {
//	console.log('+ ' + result.directory[i].attributes.title);
//      }
